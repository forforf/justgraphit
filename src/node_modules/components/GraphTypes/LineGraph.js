
import React from 'react';
import * as d3 from 'd3';

function LineGraph(props) {
  const chartId = props.chartId || 'jgi-line-graph';
  const data = props.graphData;
  // const margin = {top: 5, right: 50, botom: 20, left: 50};
  // const w = props.width - (margin.left + margin.right);
  // const h = props.height - (margin.top + margin.bottom);

  // percent graph axis should extend past max y
  const graphFactor = 0.1;

  console.log('graph this data: ', data);
  data.forEach(function(i){i['dt'] = new Date(i.datetime) });

  console.log('data length: ', data.length);
  if(data.length === 0) { return null }
  if(data.length === 1) { return null }

  var num = function(d){ return d.number};
  var minNum = d3.min(data, num);
  var maxNum = d3.max(data, num);

  //reset mins and maxs so all data fits inside graph
  minNum = minNum - Math.abs(minNum*graphFactor);
  maxNum = maxNum + Math.abs(maxNum*graphFactor);

  var startDt = data[0].dt;
  var endDt = data[data.length-1].dt;

  console.log(minNum, maxNum, startDt, endDt);

  var w = 400;
  var h = 200;
  var margin = 20;

  var y = d3.scaleLinear()
      .domain( [ minNum, maxNum ] )
      .range([0 + margin, h - margin]);

  var x = d3.scaleTime()
      .domain( [ startDt, endDt ] )
      .range([0 + margin, w - margin]);


  var xVal = function(d) { return x(d.dt); };
  var yVal = function(d) { return -1 * y(d.number); };

  var transform = 'translate(0, 200)';

  // var transform='translate(' + margin.left + ',' + margin.top + ')';

  // var line = d3.line()
  //     .x(function (d) {
  //       return x(d.date);
  //     })
  //     .y(function (d) {
  //       return y(d.count);
  //     }).curve(d3.curveCardinal);

  var line = d3.line()
      .x(xVal)
      .y(yVal);

  // const tbdElem = graphData.map((graphObj,i) =>
  //   <li key={i}>{graphObj.number} : {graphObj.datetime}</li>
  // );

  return (
      <div>
        <ul> This is a line graph for:
          tbdElem
        </ul>

        <svg id={chartId} width={props.width} height={props.height}>

          <g transform={transform}>
            <path className="line shadow" d={line(data)} strokeLinecap="round"/>
          </g>
        </svg>
      </div>
  );
}

export default LineGraph;
